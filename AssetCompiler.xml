<?xml version="1.0"?>
<project name="AssetCompiler" basedir="Tasks" default="">

	<property name="resource.directory" value="htdocs/typo3conf/ext/speciality/Resources/Public"/>
	<property name="component.directory" value="${resource.directory}/Components"/>
	<property name="component.bootstrap.fonts" value="${component.directory}/twbs-bootstrap-sass/vendor/assets/fonts/bootstrap"/>
	<property name="component.bootstrap.javascript" value="${component.directory}/twbs-bootstrap-sass/vendor/assets/javascripts"/>
	<property name="component.jquery" value="${component.directory}/jquery/"/>

	<!-- ============================================  -->
	<!-- Target: bootstrap-environment                          -->
	<!-- ============================================  -->
	<target name="bootstrap-environment">
		<echo>----------------------------------------------</echo>
		<echo>| Prepare File Structure                      |</echo>
		<echo>----------------------------------------------</echo>
		<mkdir dir="${resource.directory}/Fonts"/>
		<mkdir dir="${resource.directory}/StyleSheets/Sass"/>
		<mkdir dir="${resource.directory}/Images"/>
		<mkdir dir="${resource.directory}/JavaScript"/>
	</target>

	<!-- ============================================  -->
	<!-- Target: bower                                 -->
	<!-- ============================================  -->
	<target name="bower-install" depends="bootstrap-environment">
		<echo>----------------------------------------------</echo>
		<echo>| Installing Web Components                  |</echo>
		<echo>----------------------------------------------</echo>
		<exec command="cd htdocs/typo3conf/ext/speciality; bower install" checkreturn="true" logoutput="/dev/stdout"/>

	</target>

	<target name="bower-update" depends="bootstrap-environment">
		<echo>----------------------------------------------</echo>
		<echo>| Updating Web Components                     |</echo>
		<echo>----------------------------------------------</echo>
		<exec command="cd htdocs/typo3conf/ext/speciality; bower update" checkreturn="true" logoutput="/dev/stdout"/>

	</target>

	<target name="bower-status">
		<echo>----------------------------------------------</echo>
		<echo>| Installing Web Components                  |</echo>
		<echo>----------------------------------------------</echo>
		<exec command="cd htdocs/typo3conf/ext/speciality; bower list" checkreturn="true" logoutput="/dev/stdout"/>
	</target>

	<!-- ============================================  -->
	<!-- Target: css                                   -->
	<!-- ============================================  -->
	<target name="css-compile" depends="bootstrap-environment">
		<echo>-----------------------------</echo>
		<echo>| Compiling CSS              |</echo>
		<echo>-----------------------------</echo>
		<exec command="cd htdocs/typo3conf/ext/speciality; compass compile -s compressed --force" checkreturn="true" logoutput="/dev/stdout"/>
	</target>

	<!-- ============================================  -->
	<!-- Target: watch                                   -->
	<!-- ============================================  -->
	<target name="css-watch" depends="bootstrap-environment">
		<echo>------------------------------</echo>
		<echo>| Watching and compiling CSS  |</echo>
		<echo>------------------------------</echo>
		<echo>Tip: alternatively use this command to have more output on the console as stylesheets are compiling.</echo>
		<echo>$> cd htdocs/typo3conf/ext/speciality; compass watch -s compressed</echo>

		<exec command="cd htdocs/typo3conf/ext/speciality; compass watch -s compressed" checkreturn="true" logoutput="/dev/stdout"/>
	</target>

	<!-- ============================================  -->
	<!-- Target: check                                 -->
	<!-- ============================================  -->
	<target name="check-system">
		<echo>-----------------------------</echo>
		<echo>| Checking environment       |</echo>
		<echo>-----------------------------</echo>

		<!-- Check Bower  -->
		<exec command="which bower" outputProperty="bower.path"/>
		<if>
			<istrue value="${bower.path}"/>
			<then>
				<echo>[OK] Bower was found at ${bower.path}</echo>
				<exec command="bower --version" outputProperty="bower.version"/>
				<echo>     Current version: ${bower.version}</echo>
			</then>
			<else>
				<echo>[ERROR] Bower was not found on your system. It could be installed with command: "npm install -g bower"</echo>
			</else>
		</if>

		<!-- Check Compass  -->
		<exec command="which compass" outputProperty="compass.path"/>
		<if>
			<istrue value="${compass.path}"/>
			<then>
				<echo>[OK] Compass was found at ${compass.path}</echo>
				<exec command="compass --version | awk 'NR==1{print $2}'" outputProperty="compass.version"/>
				<echo>     Current version: ${compass.version}</echo>
			</then>
			<else>
				<echo>[ERROR] Compass was not found on your system. To install it, run:</echo>
				<echo>gem install --no-rdoc --no-ri sass compass; gem install sass-css-importer --pre</echo>
			</else>
		</if>

		<!-- Check Compass  -->
		<exec command="gem list sass-css-importer -i" outputProperty="gem.sass-css-importer"/>
		<if>
			<istrue value="${sass-css-importer}"/>
			<then>
				<echo>[OK] Gem "sass-css-importer" is installed</echo>
			</then>
			<else>
				<echo>[ERROR] Missing gem "sass-css-importer". To install it, run:</echo>
				<echo>gem install sass-css-importer --pre</echo>
			</else>
		</if>
		<echo></echo>
	</target>

</project>